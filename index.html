<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ETL Testing Quiz (JSON-Based)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, Helvetica, sans-serif; padding:20px; background:#f7f9fb; color:#222; }
    .card { background:white; border-radius:8px; padding:20px; max-width:720px; margin:20px auto; box-shadow:0 6px 18px rgba(20,30,40,0.08); }
    h1 { font-size:20px; margin:0 0 12px; }
    .question { font-weight:600; margin-bottom:12px; }
    .choices { margin: 12px 0; }
    .choice { display:block; margin:8px 0; }
    .explain { margin-top:12px; padding:12px; border-radius:6px; background:#f1f7ff; color:#0b57a4; display:none; }
    .explain.wrong { background:#fff4f2; color:#9b2b2b; }
    .controls { display:flex; gap:8px; margin-top:18px; }
    button { padding:8px 14px; border-radius:6px; border:0; cursor:pointer; }
    button:disabled { opacity:0.5; cursor:default; }
    .btn-primary { background:#0b69ff; color:white; }
    .btn-ghost { background:#eef2ff; color:#0b69ff; }
    .meta { font-size:12px; color:#666; margin-top:10px; }
    .score { font-size:16px; margin-top:10px; font-weight:600; }
  </style>
</head>
<body>
  <div class="card" id="quiz-card">
    <h1>ETL Testing Mini-Quiz</h1>
    <div id="question-area"></div>
    <div class="controls">
      <button id="prevBtn" class="btn-ghost">Previous</button>
      <button id="checkBtn" class="btn-primary">Check Answer</button>
      <button id="nextBtn" class="btn-ghost">Next</button>
    </div>
    <div class="meta">Tip: choose an answer and click <strong>Check Answer</strong> to see explanation.</div>
    <div class="score" id="scoreArea" style="display:none;"></div>
  </div>

<script>
let questions = [];
let current = 0;
let score = 0;
let answered = [];

const qArea = document.getElementById('question-area');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const checkBtn = document.getElementById('checkBtn');
const scoreArea = document.getElementById('scoreArea');

// Load questions from JSON
fetch('./resources/qna.json')
  .then(res => res.json())
  .then(data => {
    questions = data;
    answered = Array(questions.length).fill(false);
    renderQuestion(current);
  })
  .catch(err => {
    qArea.innerHTML = '<div class="question">Failed to load quiz questions.</div>';
    console.error('Error loading questions.json:', err);
  });

function renderQuestion(index) {
  const q = questions[index];
  qArea.innerHTML = '';
  const qEl = document.createElement('div');
  qEl.innerHTML = `
    <div class="question">Q${index+1}. ${escapeHtml(q.question)}</div>
    <div class="choices" id="choices"></div>
    <div class="explain" id="explain"></div>
  `;
  qArea.appendChild(qEl);

  const choicesDiv = document.getElementById('choices');
  q.choices.forEach((c, i) => {
    const id = 'c_' + index + '_' + i;
    const label = document.createElement('label');
    label.className = 'choice';
    label.innerHTML = `<input type="radio" name="q${index}" id="${id}" value="${i}"> ${escapeHtml(c)}`;
    choicesDiv.appendChild(label);
  });

  prevBtn.disabled = index === 0;
  nextBtn.disabled = index === questions.length - 1;
  checkBtn.disabled = answered[index];
  document.getElementById('explain').style.display = 'none';
}

function escapeHtml(unsafe) {
  return unsafe.replace(/[&<"']/g, function(m) {
    return {'&':'&amp;','<':'&lt;','"':'&quot;',"'":'&#039;'}[m];
  });
}

function getSelectedChoice(index) {
  const radios = document.getElementsByName('q' + index);
  for (let r of radios) {
    if (r.checked) return parseInt(r.value, 10);
  }
  return null;
}

function showExplanation(index, selected) {
  const expDiv = document.getElementById('explain');
  const q = questions[index];
  if (selected === q.correctIndex) {
    expDiv.className = 'explain';
    expDiv.innerHTML = '<strong>Correct!</strong> ' + escapeHtml(q.explanation);
    expDiv.style.display = 'block';
  } else {
    expDiv.className = 'explain wrong';
    const wrongText = q.wrongExplanations[selected] || 'That is not correct.';
    expDiv.innerHTML = '<strong>Incorrect.</strong> ' + escapeHtml(wrongText) + '<br><br><strong>Correct answer:</strong> ' + escapeHtml(q.choices[q.correctIndex]) + '<br><br>' + escapeHtml(q.explanation);
    expDiv.style.display = 'block';
  }
}

checkBtn.addEventListener('click', function() {
  const sel = getSelectedChoice(current);
  if (sel === null) { alert('Please select an answer.'); return; }
  if (!answered[current]) {
    answered[current] = true;
    if (sel === questions[current].correctIndex) score++;
    showExplanation(current, sel);
    checkBtn.disabled = true;
  }
  updateScoreArea();
});

prevBtn.addEventListener('click', function() {
  if (current > 0) {
    current--;
    renderQuestion(current);
  }
});

nextBtn.addEventListener('click', function() {
  if (current < questions.length - 1) {
    current++;
    renderQuestion(current);
  } else {
    renderSummary();
  }
});

function renderSummary() {
  qArea.innerHTML = '<div class="question">Quiz Completed</div><div class="meta">Thanks for completing the quiz.</div>';
  scoreArea.style.display = 'block';
  scoreArea.textContent = 'Score: ' + score + ' / ' + questions.length;
  prevBtn.disabled = true;
  nextBtn.disabled = true;
  checkBtn.disabled = true;
}

function updateScoreArea() {
  scoreArea.style.display = 'block';
  scoreArea.textContent = 'Score: ' + score + ' / ' + questions.length;
}
</script>
</body>
</html>
